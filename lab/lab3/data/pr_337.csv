337,IDEA-143271 - Correctly stub classes containing a dollar in their name.
2015-12-29T16:34:54Z,discuss,This PR adds a fix for https://youtrack.jetbrains.com/issue/IDEA-143271.
2015-12-29T16:34:54Z,discuss,"Classes containing a dollar in their name, but which are not nested classes generated by javac, are correctly stubbed. There is one remaining problem though, and I can't find a good solution to fix it. The class is correctly indexed as Foo$Bar, but the Type's canonical text is still Foo.Bar because StubBuildingVisitor is making an incorrect assumption:"
2015-12-31T11:34:27Z,discuss,"Unfortunately, we cannot accept this.
I tried this approach before, and it causes a great deal more problem than it solves.
I wish JVMS has never allowed '$' in identifiers :)"
2015-12-31T11:39:07Z,discuss,Do you plan on fixing the problem in any other way?
2015-12-31T11:48:21Z,discuss,"Sure, but it may take some time. Looking now on your sample project."
2015-12-31T12:26:09Z,discuss,IMO ClsFileImpl.buildFileStub can detect inner class state correctly from content (after calling ClassFileViewProvider.isInnerClass(file))
2015-12-31T12:56:12Z,discuss,I'm currently testing the following fix in ClassFileViewProvider:
2015-12-31T12:56:12Z,discuss,"i.e. I always instantiate a ClsFileImpl to read the bytecode, but I only return it if it doesn't represent an inner class. Then the fix mentioned by @nicity should work for the other usage of isInnerClass."
2015-12-31T13:23:03Z,discuss,@trespasserw @nicity do you think this fix is better? bjansen@5a97c80
2015-12-31T14:15:31Z,discuss,"@bjansen less effective, and the file without a stub doesn't make much sense anyway. @nicity is right, this should be fixed in ClassFileViewProvider.isInnerClass()."
2015-12-31T14:21:10Z,discuss,But it's not possible to determine whether it's an inner class without actually reading the class content...
2015-12-31T14:21:10Z,discuss,"Not sure I understand what you mean, I'm not creating files without stubs?"
2015-12-31T14:51:46Z,discuss,That's true. I'm afraid content reading is unavoidable here.
2015-12-31T14:51:46Z,discuss,"You do this by always creating a new ClsFileImpl instance. Invoking getClasses() on it will request for a stub for this file - which is absent because 'ClasFileImpl.buildFileStub()` checks, too, for whether a class is inner."
2015-12-29T15:53:18Z,commit,Correctly stub classes containing a dollar in their name.,github.com/JetBrains/intellij-community/pull/337/commits/141d2579d2170d199f85151ab82c2c5c08d5fbc5
